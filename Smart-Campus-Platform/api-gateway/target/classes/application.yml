server:
  port: 9080
spring:
  application:
    name: api-gateway
  data:
    redis:
      # ============ LOCAL DEVELOPMENT (IntelliJ IDEA) ============
      # Uncomment below for running locally on your machine
        host: localhost
        port: 6379
      
      # ============ DOCKER DEPLOYMENT ============
      # Comment below and uncomment above for local development
      # host: redis
      # port: 6379
  cloud:
    gateway:
      default-filters:
        - RemoveRequestHeader=Cookie
        - name: RequestRateLimiter
          args:
            redis-rate-limiter.replenishRate: 10  # tokens per second
            redis-rate-limiter.burstCapacity: 20  # max tokens in bucket
            redis-rate-limiter.requestedTokens: 1 # tokens per request
            key-resolver: "#{@ipAddressKeyResolver}"
        - name: Retry
          args:
            retries: 3
            statuses: BAD_GATEWAY,SERVICE_UNAVAILABLE,GATEWAY_TIMEOUT
            methods: GET
            backoff:
              firstBackoff: 100ms
              maxBackoff: 1000ms
              factor: 2
              basedOnPreviousValue: false
      routes:
        # ============ LOCAL DEVELOPMENT (IntelliJ IDEA) ============
        # Uncomment below for running locally on your machine
        - id: auth-service
          uri: http://localhost:9081
          predicates:
            - Path=/auth/**
        - id: booking-service
          uri: http://localhost:9082
          predicates:
            - Path=/booking/**
          filters:
            - StripPrefix=1
        - id: marketplace-service
          uri: http://localhost:9083
          predicates:
            - Path=/marketplace/**
          filters:
            - StripPrefix=1
        - id: order-service
          uri: http://localhost:9084
          predicates:
            - Path=/orders/**
        - id: exam-service
          uri: http://localhost:9085
          predicates:
            - Path=/exam/**
          filters:
            - StripPrefix=1
        - id: notification-service
          uri: http://localhost:9086
          predicates:
            - Path=/notifications/**
        - id: iot-service
          uri: http://localhost:9087
          predicates:
            - Path=/iot/**
          filters:
            - StripPrefix=1
        # ============ DOCKER DEPLOYMENT ============
        # Comment below and uncomment above for local development
#        - id: auth-service
#          uri: http://auth-service:8081
#          predicates:
#            - Path=/auth/**
#        - id: booking-service
#          uri: http://booking-service:8082
#          predicates:
#            - Path=/booking/**
#          filters:
#            - StripPrefix=1
#        - id: marketplace-service
#          uri: http://marketplace-service:8083
#          predicates:
#            - Path=/marketplace/**
#          filters:
#            - StripPrefix=1
#        - id: order-service
#          uri: http://order-service:8084
#          predicates:
#            - Path=/orders/**
#        - id: exam-service
#          uri: http://exam-service:8085
#          predicates:
#            - Path=/exam/**
#          filters:
#            - StripPrefix=1
#        - id: notification-service
#          uri: http://notification-service:8086
#          predicates:
#            - Path=/notifications/**
#        - id: iot-service
#          uri: http://iot-service:8087
#          predicates:
#            - Path=/iot/**
#          filters:
#            - StripPrefix=1
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always
app:
  jwt:
    secret: ${JWT_SECRET:TXlfU21hcnRDYW1wdXNfU2VjcmV0X0tleTEyMzQ1Njc4OTAxMjM0NTY3OA==}

